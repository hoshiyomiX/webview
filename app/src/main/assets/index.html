<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="theme-color" content="#1C1B1F">
    <title>devBattery Monitor</title>
    <style>
        :root {
            /* Material Design 3 - Dynamic Colors (Dark Theme Default) */
            --md-sys-color-primary: #D0BCFF;
            --md-sys-color-on-primary: #381E72;
            --md-sys-color-primary-container: #4F378B;
            --md-sys-color-on-primary-container: #EADDFF;
            --md-sys-color-secondary: #CCC2DC;
            --md-sys-color-secondary-container: #4A4458;
            --md-sys-color-on-secondary-container: #E8DEF8;
            --md-sys-color-tertiary: #EFB8C8;
            --md-sys-color-tertiary-container: #633B48;
            --md-sys-color-on-tertiary-container: #FFD8E4;
            --md-sys-color-surface: #1C1B1F;
            --md-sys-color-surface-dim: #141316;
            --md-sys-color-surface-bright: #3B383E;
            --md-sys-color-surface-container: #211F26;
            --md-sys-color-surface-container-high: #2B2930;
            --md-sys-color-surface-container-highest: #36343B;
            --md-sys-color-on-surface: #E6E0E9;
            --md-sys-color-on-surface-variant: #CAC4D0;
            --md-sys-color-outline: #938F99;
            --md-sys-color-outline-variant: #49454F;
            --md-sys-color-error: #F2B8B5;
            --md-sys-color-on-error: #601410;
            --md-sys-color-error-container: #8C1D18;
            
            /* Android 16 QPR1 Motion Tokens */
            --md-motion-emphasized: cubic-bezier(0.2, 0, 0, 1);
            --md-motion-emphasized-decel: cubic-bezier(0.05, 0.7, 0.1, 1);
            --md-motion-emphasized-accel: cubic-bezier(0.3, 0, 0.8, 0.15);
            --md-motion-standard: cubic-bezier(0.2, 0, 0, 1);
            --md-motion-spring: cubic-bezier(0.5, 1.5, 0.5, 1);
        }
        
        /* (Keeping all existing CSS - too long to repeat here)
           ... same styles as before ...
        */
    </style>
</head>
<body>
    <!-- (HTML content sama seperti sebelumnya) -->
    <script>
        let debugData = '';
        let hasRoot = false;
        let previousValues = {};
        let isCharging = false;
        let bubbleSpawnInterval = null;
        let bubbleCount = 0;
        let lastStatus = '';
        let rootModalShown = false;
        let currentCapacity = 0;
        let currentTheme = 'dark';
        
        const debugLog = {
            updates: 0,
            lastUpdate: Date.now(),
            batteryHistory: [],
            statusChanges: [],
            bubbleStats: { total: 0, active: 0 },
            performance: { avgUpdateTime: 0, totalTime: 0 },
            errors: [],
            statusDetection: [],
            powerSource: [],
            themeChanges: []
        };
        
        console.log('[INIT] ‚úÖ Simple liquid fill loaded (NO waves)');
        console.log('[THEME] üîó Using Android JavaScript Bridge for theme detection');
        
        // üé® THEME MANAGEMENT - NOW WITH ANDROID BRIDGE
        function applyTheme(theme) {
            const root = document.documentElement;
            const prevTheme = currentTheme;
            currentTheme = theme;
            
            if (theme === 'light') {
                root.style.setProperty('--md-sys-color-primary', '#6750A4');
                root.style.setProperty('--md-sys-color-on-primary', '#FFFFFF');
                root.style.setProperty('--md-sys-color-primary-container', '#EADDFF');
                root.style.setProperty('--md-sys-color-on-primary-container', '#21005D');
                root.style.setProperty('--md-sys-color-secondary', '#625B71');
                root.style.setProperty('--md-sys-color-secondary-container', '#E8DEF8');
                root.style.setProperty('--md-sys-color-on-secondary-container', '#1D192B');
                root.style.setProperty('--md-sys-color-tertiary', '#7D5260');
                root.style.setProperty('--md-sys-color-tertiary-container', '#FFD8E4');
                root.style.setProperty('--md-sys-color-on-tertiary-container', '#31111D');
                root.style.setProperty('--md-sys-color-surface', '#FFFBFE');
                root.style.setProperty('--md-sys-color-surface-dim', '#DED8E1');
                root.style.setProperty('--md-sys-color-surface-bright', '#FFFBFE');
                root.style.setProperty('--md-sys-color-surface-container', '#F3EDF7');
                root.style.setProperty('--md-sys-color-surface-container-high', '#ECE6F0');
                root.style.setProperty('--md-sys-color-surface-container-highest', '#E6E0E9');
                root.style.setProperty('--md-sys-color-on-surface', '#1C1B1F');
                root.style.setProperty('--md-sys-color-on-surface-variant', '#49454F');
                root.style.setProperty('--md-sys-color-outline', '#79747E');
                root.style.setProperty('--md-sys-color-outline-variant', '#CAC4D0');
                root.style.setProperty('--md-sys-color-error', '#B3261E');
                root.style.setProperty('--md-sys-color-on-error', '#FFFFFF');
                root.style.setProperty('--md-sys-color-error-container', '#F9DEDC');
                
                document.querySelector('meta[name="theme-color"]').setAttribute('content', '#FFFBFE');
                console.log('[THEME] üåû Switched to LIGHT mode');
            } else {
                root.style.setProperty('--md-sys-color-primary', '#D0BCFF');
                root.style.setProperty('--md-sys-color-on-primary', '#381E72');
                root.style.setProperty('--md-sys-color-primary-container', '#4F378B');
                root.style.setProperty('--md-sys-color-on-primary-container', '#EADDFF');
                root.style.setProperty('--md-sys-color-secondary', '#CCC2DC');
                root.style.setProperty('--md-sys-color-secondary-container', '#4A4458');
                root.style.setProperty('--md-sys-color-on-secondary-container', '#E8DEF8');
                root.style.setProperty('--md-sys-color-tertiary', '#EFB8C8');
                root.style.setProperty('--md-sys-color-tertiary-container', '#633B48');
                root.style.setProperty('--md-sys-color-on-tertiary-container', '#FFD8E4');
                root.style.setProperty('--md-sys-color-surface', '#1C1B1F');
                root.style.setProperty('--md-sys-color-surface-dim', '#141316');
                root.style.setProperty('--md-sys-color-surface-bright', '#3B383E');
                root.style.setProperty('--md-sys-color-surface-container', '#211F26');
                root.style.setProperty('--md-sys-color-surface-container-high', '#2B2930');
                root.style.setProperty('--md-sys-color-surface-container-highest', '#36343B');
                root.style.setProperty('--md-sys-color-on-surface', '#E6E0E9');
                root.style.setProperty('--md-sys-color-on-surface-variant', '#CAC4D0');
                root.style.setProperty('--md-sys-color-outline', '#938F99');
                root.style.setProperty('--md-sys-color-outline-variant', '#49454F');
                root.style.setProperty('--md-sys-color-error', '#F2B8B5');
                root.style.setProperty('--md-sys-color-on-error', '#601410');
                root.style.setProperty('--md-sys-color-error-container', '#8C1D18');
                
                document.querySelector('meta[name="theme-color"]').setAttribute('content', '#1C1B1F');
                console.log('[THEME] üåô Applied DARK mode');
            }
            
            if (prevTheme !== theme) {
                debugLog.themeChanges.push({ 
                    time: new Date().toISOString(), 
                    from: prevTheme,
                    to: theme,
                    source: 'applyTheme()'
                });
            }
        }
        
        // ‚úÖ USE ANDROID JAVASCRIPT BRIDGE FOR THEME DETECTION
        try {
            if (typeof Android !== 'undefined' && typeof Android.getSystemTheme === 'function') {
                const systemTheme = Android.getSystemTheme();
                applyTheme(systemTheme);
                console.log('[THEME] ‚úÖ Android Bridge detected system theme:', systemTheme);
                debugLog.themeChanges.push({
                    time: new Date().toISOString(),
                    from: 'none',
                    to: systemTheme,
                    source: 'Android.getSystemTheme()'
                });
            } else {
                // Fallback: force dark theme
                applyTheme('dark');
                console.log('[THEME] ‚ö†Ô∏è Android Bridge not available, using dark fallback');
            }
        } catch (e) {
            applyTheme('dark');
            console.log('[THEME] ‚ùå Error accessing Android Bridge:', e.message);
        }
        
        // Remove unreliable matchMedia listener
        // (MainActivity.onConfigurationChanged will call applyTheme directly)
        
        // ... (rest of JavaScript code sama seperti sebelumnya)
    </script>
</body>
</html>