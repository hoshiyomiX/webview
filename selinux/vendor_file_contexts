################################################################################
# Battery Monitor - SELinux File Contexts
################################################################################
# 
# FILE: vendor_file_contexts
# LOCATION: /vendor/etc/selinux/vendor_file_contexts
# ACTION: APPEND these contexts to your existing vendor_file_contexts
# 
# Package: com.deviant.batterymonitor
# Install Path: /product/priv-app/BatteryMonitor/
# 
# Purpose:
#   Label battery monitor app files and ALL battery/charger sysfs paths
#   with appropriate SELinux contexts for pure sysfs reading mode.
# 
# Usage:
#   cat selinux/vendor_file_contexts >> /vendor/etc/selinux/vendor_file_contexts
# 
# Note:
#   File contexts are applied at boot time, not runtime.
#   After modifying, you must relabel filesystems or reboot.
# 
################################################################################

# ------------------------------------------------------------------------------
# APPLICATION DIRECTORIES
# ------------------------------------------------------------------------------

# Privileged app installation directory
/product/priv-app/BatteryMonitor(/.*)?                      u:object_r:privapp_data_file:s0

# App data directory
/data/data/com\.deviant\.batterymonitor(/.*)?               u:object_r:privapp_data_file:s0

# ------------------------------------------------------------------------------
# BATTERY SYSFS PATHS - PRIMARY (ALL METRICS)
# ------------------------------------------------------------------------------

# Main battery power_supply node - ALL battery metrics
# Includes: capacity, voltage_now, current_now, temp, status, etc.
/sys/class/power_supply/battery(/.*)?                       u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/battery/capacity                    u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/battery/voltage_now                 u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/battery/current_now                 u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/battery/temp                        u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/battery/status                      u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/battery/health                      u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/battery/present                     u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/battery/technology                  u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/battery/cycle_count                 u:object_r:sysfs_batteryinfo:s0

# Battery charger-related attributes
/sys/class/power_supply/battery/charger_voltage             u:object_r:sysfs_charger:s0
/sys/class/power_supply/battery/input_voltage               u:object_r:sysfs_charger:s0
/sys/class/power_supply/battery/input_current               u:object_r:sysfs_charger:s0

# ------------------------------------------------------------------------------
# BATTERY SYSFS PATHS - ALTERNATIVE (BMS)
# ------------------------------------------------------------------------------

# Battery Management System (BMS) - Alternative battery node
# Some devices (Xiaomi, OPPO, OnePlus) use bms instead of battery
/sys/class/power_supply/bms(/.*)?                           u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/bms/capacity                        u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/bms/voltage_now                     u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/bms/current_now                     u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/bms/temp                            u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/bms/status                          u:object_r:sysfs_batteryinfo:s0

# ------------------------------------------------------------------------------
# BATTERY SYSFS PATHS - ALTERNATIVE (BAT0)
# ------------------------------------------------------------------------------

# Legacy/ACPI battery interface (rare on Android)
/sys/class/power_supply/BAT0(/.*)?                          u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/BAT0/capacity                       u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/BAT0/voltage_now                    u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/BAT0/current_now                    u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/BAT0/temp                           u:object_r:sysfs_batteryinfo:s0
/sys/class/power_supply/BAT0/status                         u:object_r:sysfs_batteryinfo:s0

# ------------------------------------------------------------------------------
# CHARGER SYSFS PATHS - PRIMARY (MediaTek)
# ------------------------------------------------------------------------------

# MediaTek charger driver sysfs interface
/sys/devices/platform/charger(/.*)?                         u:object_r:sysfs_charger:s0
/sys/devices/platform/charger/ADC_Charger_Voltage           u:object_r:sysfs_charger:s0
/sys/devices/platform/charger/Charger_Voltage               u:object_r:sysfs_charger:s0
/sys/devices/platform/charger/Charger_Type                  u:object_r:sysfs_charger:s0
/sys/devices/platform/charger/Input_Current_Limit           u:object_r:sysfs_charger:s0
/sys/devices/platform/charger/Charging_Current              u:object_r:sysfs_charger:s0

# ------------------------------------------------------------------------------
# CHARGER SYSFS PATHS - GENERIC (power_supply class)
# ------------------------------------------------------------------------------

# Generic charger power_supply node
/sys/class/power_supply/charger(/.*)?                       u:object_r:sysfs_charger:s0
/sys/class/power_supply/charger/voltage_now                 u:object_r:sysfs_charger:s0
/sys/class/power_supply/charger/voltage_max                 u:object_r:sysfs_charger:s0
/sys/class/power_supply/charger/current_now                 u:object_r:sysfs_charger:s0
/sys/class/power_supply/charger/type                        u:object_r:sysfs_charger:s0

# USB power_supply node (charger via USB)
/sys/class/power_supply/usb(/.*)?                           u:object_r:sysfs_charger:s0
/sys/class/power_supply/usb/voltage_now                     u:object_r:sysfs_charger:s0
/sys/class/power_supply/usb/voltage_max                     u:object_r:sysfs_charger:s0
/sys/class/power_supply/usb/current_now                     u:object_r:sysfs_charger:s0

# AC power_supply node (wall charger)
/sys/class/power_supply/ac(/.*)?                            u:object_r:sysfs_charger:s0
/sys/class/power_supply/ac/voltage_now                      u:object_r:sysfs_charger:s0
/sys/class/power_supply/ac/current_now                      u:object_r:sysfs_charger:s0

# ------------------------------------------------------------------------------
# THERMAL ZONE SYSFS (TEMPERATURE FALLBACK)
# ------------------------------------------------------------------------------

# Thermal zones for temperature reading fallback
/sys/class/thermal/thermal_zone0(/.*)?                      u:object_r:sysfs_thermal:s0
/sys/class/thermal/thermal_zone0/temp                       u:object_r:sysfs_thermal:s0
/sys/class/thermal/thermal_zone1/temp                       u:object_r:sysfs_thermal:s0

# ------------------------------------------------------------------------------
# DEVICE-SPECIFIC CHARGER IC PATHS
# ------------------------------------------------------------------------------

# Qualcomm PMIC charger
/sys/class/power_supply/qpnp-charger(/.*)?                  u:object_r:sysfs_charger:s0
/sys/class/power_supply/qpnp-charger/voltage_now            u:object_r:sysfs_charger:s0

# Samsung charger IC (Maxim)
/sys/class/power_supply/max77705-charger(/.*)?              u:object_r:sysfs_charger:s0
/sys/class/power_supply/max77705-charger/voltage_now        u:object_r:sysfs_charger:s0

# Texas Instruments BQ series charger (OnePlus, Xiaomi)
/sys/class/power_supply/bq25890(/.*)?                       u:object_r:sysfs_charger:s0
/sys/class/power_supply/bq25890/voltage_now                 u:object_r:sysfs_charger:s0

# Texas Instruments BQ dual charger (Xiaomi fast charge)
/sys/class/power_supply/bq2597x-master(/.*)?                u:object_r:sysfs_charger:s0
/sys/class/power_supply/bq2597x-master/voltage_now          u:object_r:sysfs_charger:s0
/sys/class/power_supply/bq2597x-slave(/.*)?                 u:object_r:sysfs_charger:s0
/sys/class/power_supply/bq2597x-slave/voltage_now           u:object_r:sysfs_charger:s0

################################################################################
# END OF BATTERY MONITOR FILE CONTEXTS
################################################################################
# 
# METRICS READ IN PURE SYSFS MODE:
# 
# - Capacity:         /sys/class/power_supply/battery/capacity
# - Voltage:          /sys/class/power_supply/battery/voltage_now
# - Current:          /sys/class/power_supply/battery/current_now
# - Temperature:      /sys/class/power_supply/battery/temp
# - Status:           /sys/class/power_supply/battery/status
# - Charger Voltage:  /sys/devices/platform/charger/ADC_Charger_Voltage
#                     /sys/class/power_supply/charger/voltage_now
# 
# All paths automatically try multiple alternatives for device compatibility.
# 
################################################################################
# 
# FINDING YOUR DEVICE'S BATTERY PATHS:
# 
# 1. List all power_supply devices:
#    $ adb shell ls -la /sys/class/power_supply/
# 
# 2. Check battery node contents:
#    $ adb shell ls -la /sys/class/power_supply/battery/
# 
# 3. Read all battery metrics:
#    $ adb shell "cd /sys/class/power_supply/battery && cat capacity voltage_now current_now temp status"
# 
# 4. Find charger voltage path:
#    $ adb shell find /sys -name "*voltage*" 2>/dev/null | grep -E "(charger|power_supply)"
# 
# 5. If your device uses different paths, add them to this file:
#    /sys/your/custom/path/metric_name    u:object_r:sysfs_batteryinfo:s0
# 
################################################################################
# 
# VERIFICATION:
# 
# After adding contexts and rebooting:
# 
# $ adb shell ls -laZ /sys/class/power_supply/battery/capacity
# -r--r--r-- 1 root root u:object_r:sysfs_batteryinfo:s0 4096 ... capacity
# 
# $ adb shell ls -laZ /sys/devices/platform/charger/ADC_Charger_Voltage
# -r--r--r-- 1 root root u:object_r:sysfs_charger:s0 4096 ... ADC_Charger_Voltage
# 
# If showing wrong context, relabel:
# $ adb shell su -c "restorecon -Rv /sys/class/power_supply"
# $ adb shell su -c "restorecon -Rv /sys/devices/platform/charger"
# 
################################################################################
